                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 4.0.0 #11528 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module usbdisk
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _toUpper
                             12 	.globl _toLower
                             13 	.globl _supports_80_column_mode
                             14 	.globl _error
                             15 	.globl _delay_ms
                             16 	.globl _pressed_ESC
                             17 	.globl _getchar
                             18 	.globl _putchar
                             19 	.globl _ch376s_disk_write
                             20 	.globl _ch376s_disk_read
                             21 	.globl _ch376_get_sector_LBA
                             22 	.globl _ch376_locate_sector
                             23 	.globl _ch376_get_fat_info
                             24 	.globl _ch376_next_search
                             25 	.globl _ch376_open_search
                             26 	.globl _ch376_set_filename
                             27 	.globl _ch376_open_directory
                             28 	.globl _ch376_close_file
                             29 	.globl _ch376_open_file
                             30 	.globl _ch376_mount_disk
                             31 	.globl _ch376_connect_disk
                             32 	.globl _ch376_set_usb_host_mode
                             33 	.globl _ch376_plugged_in
                             34 	.globl _ch376_reset_all
                             35 	.globl _toupper
                             36 	.globl _tolower
                             37 	.globl _puts
                             38 	.globl _printf
                             39 	.globl _usbdisk_init
                             40 	.globl _usbdisk_autoexec_dsk
                             41 	.globl _usbdisk_select_dsk_file
                             42 	.globl _read_write_file_sectors
                             43 	.globl _read_write_disk_sectors
                             44 	.globl _usbdisk_close_dsk_file
                             45 ;--------------------------------------------------------
                             46 ; special function registers
                             47 ;--------------------------------------------------------
                             48 ;--------------------------------------------------------
                             49 ; ram data
                             50 ;--------------------------------------------------------
                             51 	.area _DATA
                             52 ;--------------------------------------------------------
                             53 ; ram data
                             54 ;--------------------------------------------------------
                             55 	.area _INITIALIZED
                             56 ;--------------------------------------------------------
                             57 ; absolute external ram data
                             58 ;--------------------------------------------------------
                             59 	.area _DABS (ABS)
                             60 ;--------------------------------------------------------
                             61 ; global & static initialisations
                             62 ;--------------------------------------------------------
                             63 	.area _HOME
                             64 	.area _GSINIT
                             65 	.area _GSFINAL
                             66 	.area _GSINIT
                             67 ;--------------------------------------------------------
                             68 ; Home
                             69 ;--------------------------------------------------------
                             70 	.area _HOME
                             71 	.area _HOME
                             72 ;--------------------------------------------------------
                             73 ; code
                             74 ;--------------------------------------------------------
                             75 	.area _CODE
                             76 ;../generic/usbdisk.c:11: void usbdisk_init ()
                             77 ;	---------------------------------
                             78 ; Function usbdisk_init
                             79 ; ---------------------------------
   0000                      80 _usbdisk_init::
                             81 ;../generic/usbdisk.c:13: printf ("MSXUSB-NXT v0.4 (c)Sourceror\r\n");
   0000 21r40r00      [10]   82 	ld	hl, #___str_1
   0003 E5            [11]   83 	push	hl
   0004 CDr00r00      [17]   84 	call	_puts
   0007 F1            [10]   85 	pop	af
                             86 ;../generic/usbdisk.c:14: ch376_reset_all();
   0008 CDr00r00      [17]   87 	call	_ch376_reset_all
                             88 ;../generic/usbdisk.c:15: if (!ch376_plugged_in())
   000B CDr00r00      [17]   89 	call	_ch376_plugged_in
   000E CB 45         [ 8]   90 	bit	0, l
   0010 20 08         [12]   91 	jr	NZ,00102$
                             92 ;../generic/usbdisk.c:16: error ("-CH376 NOT detected");
   0012 21r5Er00      [10]   93 	ld	hl, #___str_2
   0015 E5            [11]   94 	push	hl
   0016 CDr00r00      [17]   95 	call	_error
   0019 F1            [10]   96 	pop	af
   001A                      97 00102$:
                             98 ;../generic/usbdisk.c:18: ch376_set_usb_host_mode(USB_MODE_HOST);
   001A 3E 06         [ 7]   99 	ld	a, #0x06
   001C F5            [11]  100 	push	af
   001D 33            [ 6]  101 	inc	sp
   001E CDr00r00      [17]  102 	call	_ch376_set_usb_host_mode
   0021 33            [ 6]  103 	inc	sp
                            104 ;../generic/usbdisk.c:19: if (!ch376_connect_disk ())
   0022 CDr00r00      [17]  105 	call	_ch376_connect_disk
   0025 CB 45         [ 8]  106 	bit	0, l
   0027 20 08         [12]  107 	jr	NZ,00104$
                            108 ;../generic/usbdisk.c:20: error ("-Connect USB device");
   0029 21r72r00      [10]  109 	ld	hl, #___str_3
   002C E5            [11]  110 	push	hl
   002D CDr00r00      [17]  111 	call	_error
   0030 F1            [10]  112 	pop	af
   0031                     113 00104$:
                            114 ;../generic/usbdisk.c:22: if (!ch376_mount_disk ())
   0031 CDr00r00      [17]  115 	call	_ch376_mount_disk
   0034 CB 45         [ 8]  116 	bit	0, l
   0036 C0            [11]  117 	ret	NZ
                            118 ;../generic/usbdisk.c:23: error ("-Not a valid disk");
   0037 21r86r00      [10]  119 	ld	hl, #___str_4
   003A E5            [11]  120 	push	hl
   003B CDr00r00      [17]  121 	call	_error
   003E F1            [10]  122 	pop	af
                            123 ;../generic/usbdisk.c:25: }
   003F C9            [10]  124 	ret
   0040                     125 ___str_1:
   0040 4D 53 58 55 53 42   126 	.ascii "MSXUSB-NXT v0.4 (c)Sourceror"
        2D 4E 58 54 20 76
        30 2E 34 20 28 63
        29 53 6F 75 72 63
        65 72 6F 72
   005C 0D                  127 	.db 0x0d
   005D 00                  128 	.db 0x00
   005E                     129 ___str_2:
   005E 2D 43 48 33 37 36   130 	.ascii "-CH376 NOT detected"
        20 4E 4F 54 20 64
        65 74 65 63 74 65
        64
   0071 00                  131 	.db 0x00
   0072                     132 ___str_3:
   0072 2D 43 6F 6E 6E 65   133 	.ascii "-Connect USB device"
        63 74 20 55 53 42
        20 64 65 76 69 63
        65
   0085 00                  134 	.db 0x00
   0086                     135 ___str_4:
   0086 2D 4E 6F 74 20 61   136 	.ascii "-Not a valid disk"
        20 76 61 6C 69 64
        20 64 69 73 6B
   0097 00                  137 	.db 0x00
                            138 ;../generic/usbdisk.c:27: char* toLower(char* s) {
                            139 ;	---------------------------------
                            140 ; Function toLower
                            141 ; ---------------------------------
   0098                     142 _toLower::
                            143 ;../generic/usbdisk.c:28: for(char *p=s; *p; p++) *p=tolower(*p);
   0098 D1            [10]  144 	pop	de
   0099 C1            [10]  145 	pop	bc
   009A C5            [11]  146 	push	bc
   009B D5            [11]  147 	push	de
   009C                     148 00103$:
   009C 0A            [ 7]  149 	ld	a, (bc)
   009D B7            [ 4]  150 	or	a, a
   009E 28 0F         [12]  151 	jr	Z,00101$
   00A0 5F            [ 4]  152 	ld	e, a
   00A1 16 00         [ 7]  153 	ld	d, #0x00
   00A3 C5            [11]  154 	push	bc
   00A4 D5            [11]  155 	push	de
   00A5 CDr00r00      [17]  156 	call	_tolower
   00A8 F1            [10]  157 	pop	af
   00A9 C1            [10]  158 	pop	bc
   00AA 7D            [ 4]  159 	ld	a, l
   00AB 02            [ 7]  160 	ld	(bc), a
   00AC 03            [ 6]  161 	inc	bc
   00AD 18 ED         [12]  162 	jr	00103$
   00AF                     163 00101$:
                            164 ;../generic/usbdisk.c:29: return s;
   00AF C1            [10]  165 	pop	bc
   00B0 E1            [10]  166 	pop	hl
   00B1 E5            [11]  167 	push	hl
   00B2 C5            [11]  168 	push	bc
                            169 ;../generic/usbdisk.c:30: }
   00B3 C9            [10]  170 	ret
                            171 ;../generic/usbdisk.c:31: char* toUpper(char* s) {
                            172 ;	---------------------------------
                            173 ; Function toUpper
                            174 ; ---------------------------------
   00B4                     175 _toUpper::
                            176 ;../generic/usbdisk.c:32: for(char *p=s; *p; p++) *p=toupper(*p);
   00B4 D1            [10]  177 	pop	de
   00B5 C1            [10]  178 	pop	bc
   00B6 C5            [11]  179 	push	bc
   00B7 D5            [11]  180 	push	de
   00B8                     181 00103$:
   00B8 0A            [ 7]  182 	ld	a, (bc)
   00B9 B7            [ 4]  183 	or	a, a
   00BA 28 0F         [12]  184 	jr	Z,00101$
   00BC 5F            [ 4]  185 	ld	e, a
   00BD 16 00         [ 7]  186 	ld	d, #0x00
   00BF C5            [11]  187 	push	bc
   00C0 D5            [11]  188 	push	de
   00C1 CDr00r00      [17]  189 	call	_toupper
   00C4 F1            [10]  190 	pop	af
   00C5 C1            [10]  191 	pop	bc
   00C6 7D            [ 4]  192 	ld	a, l
   00C7 02            [ 7]  193 	ld	(bc), a
   00C8 03            [ 6]  194 	inc	bc
   00C9 18 ED         [12]  195 	jr	00103$
   00CB                     196 00101$:
                            197 ;../generic/usbdisk.c:33: return s;
   00CB C1            [10]  198 	pop	bc
   00CC E1            [10]  199 	pop	hl
   00CD E5            [11]  200 	push	hl
   00CE C5            [11]  201 	push	bc
                            202 ;../generic/usbdisk.c:34: }
   00CF C9            [10]  203 	ret
                            204 ;../generic/usbdisk.c:36: bool usbdisk_autoexec_dsk()
                            205 ;	---------------------------------
                            206 ; Function usbdisk_autoexec_dsk
                            207 ; ---------------------------------
   00D0                     208 _usbdisk_autoexec_dsk::
                            209 ;../generic/usbdisk.c:41: ch376_set_filename ("/");
   00D0 21r37r01      [10]  210 	ld	hl, #___str_5
   00D3 E5            [11]  211 	push	hl
   00D4 CDr00r00      [17]  212 	call	_ch376_set_filename
   00D7 F1            [10]  213 	pop	af
                            214 ;../generic/usbdisk.c:42: if (!ch376_open_directory())
   00D8 CDr00r00      [17]  215 	call	_ch376_open_directory
   00DB CB 45         [ 8]  216 	bit	0, l
   00DD 20 08         [12]  217 	jr	NZ,00102$
                            218 ;../generic/usbdisk.c:44: error ("-Directory not opened");
   00DF 21r39r01      [10]  219 	ld	hl, #___str_6
   00E2 E5            [11]  220 	push	hl
   00E3 CDr00r00      [17]  221 	call	_error
   00E6 F1            [10]  222 	pop	af
   00E7                     223 00102$:
                            224 ;../generic/usbdisk.c:48: ch376_set_filename ("AUTOEXEC.DSK");
   00E7 21r4Fr01      [10]  225 	ld	hl, #___str_7
   00EA E5            [11]  226 	push	hl
   00EB CDr00r00      [17]  227 	call	_ch376_set_filename
   00EE F1            [10]  228 	pop	af
                            229 ;../generic/usbdisk.c:49: if (ch376_open_file()==true)
   00EF CDr00r00      [17]  230 	call	_ch376_open_file
   00F2 CB 45         [ 8]  231 	bit	0, l
   00F4 28 3E         [12]  232 	jr	Z,00110$
                            233 ;../generic/usbdisk.c:51: printf ("\r\nStarting AUTOEXEC.DSK or press ESC ");
   00F6 21r5Cr01      [10]  234 	ld	hl, #___str_8
   00F9 E5            [11]  235 	push	hl
   00FA CDr00r00      [17]  236 	call	_printf
   00FD F1            [10]  237 	pop	af
                            238 ;../generic/usbdisk.c:52: for (cnt_times=3;cnt_times>0;cnt_times--)
   00FE 01 03 03      [10]  239 	ld	bc, #0x0303
   0101                     240 00111$:
                            241 ;../generic/usbdisk.c:54: delay_ms (1000);
   0101 C5            [11]  242 	push	bc
   0102 21 E8 03      [10]  243 	ld	hl, #0x03e8
   0105 E5            [11]  244 	push	hl
   0106 CDr00r00      [17]  245 	call	_delay_ms
   0109 F1            [10]  246 	pop	af
   010A CDr00r00      [17]  247 	call	_pressed_ESC
   010D C1            [10]  248 	pop	bc
   010E CB 45         [ 8]  249 	bit	0, l
   0110 20 10         [12]  250 	jr	NZ,00105$
                            251 ;../generic/usbdisk.c:57: printf (".");
   0112 C5            [11]  252 	push	bc
   0113 21r82r01      [10]  253 	ld	hl, #___str_9
   0116 E5            [11]  254 	push	hl
   0117 CDr00r00      [17]  255 	call	_printf
   011A F1            [10]  256 	pop	af
   011B C1            [10]  257 	pop	bc
                            258 ;../generic/usbdisk.c:52: for (cnt_times=3;cnt_times>0;cnt_times--)
   011C 0D            [ 4]  259 	dec	c
   011D 41            [ 4]  260 	ld	b, c
   011E 79            [ 4]  261 	ld	a, c
   011F B7            [ 4]  262 	or	a, a
   0120 20 DF         [12]  263 	jr	NZ,00111$
   0122                     264 00105$:
                            265 ;../generic/usbdisk.c:59: if (cnt_times==0)
   0122 78            [ 4]  266 	ld	a, b
   0123 B7            [ 4]  267 	or	a, a
   0124 20 0B         [12]  268 	jr	NZ,00107$
                            269 ;../generic/usbdisk.c:61: printf ("\r\n");
   0126 21r84r01      [10]  270 	ld	hl, #___str_11
   0129 E5            [11]  271 	push	hl
   012A CDr00r00      [17]  272 	call	_puts
   012D F1            [10]  273 	pop	af
                            274 ;../generic/usbdisk.c:62: return true;
   012E 2E 01         [ 7]  275 	ld	l, #0x01
   0130 C9            [10]  276 	ret
   0131                     277 00107$:
                            278 ;../generic/usbdisk.c:66: ch376_close_file ();
   0131 CDr00r00      [17]  279 	call	_ch376_close_file
   0134                     280 00110$:
                            281 ;../generic/usbdisk.c:69: return false;
   0134 2E 00         [ 7]  282 	ld	l, #0x00
                            283 ;../generic/usbdisk.c:70: }
   0136 C9            [10]  284 	ret
   0137                     285 ___str_5:
   0137 2F                  286 	.ascii "/"
   0138 00                  287 	.db 0x00
   0139                     288 ___str_6:
   0139 2D 44 69 72 65 63   289 	.ascii "-Directory not opened"
        74 6F 72 79 20 6E
        6F 74 20 6F 70 65
        6E 65 64
   014E 00                  290 	.db 0x00
   014F                     291 ___str_7:
   014F 41 55 54 4F 45 58   292 	.ascii "AUTOEXEC.DSK"
        45 43 2E 44 53 4B
   015B 00                  293 	.db 0x00
   015C                     294 ___str_8:
   015C 0D                  295 	.db 0x0d
   015D 0A                  296 	.db 0x0a
   015E 53 74 61 72 74 69   297 	.ascii "Starting AUTOEXEC.DSK or press ESC "
        6E 67 20 41 55 54
        4F 45 58 45 43 2E
        44 53 4B 20 6F 72
        20 70 72 65 73 73
        20 45 53 43 20
   0181 00                  298 	.db 0x00
   0182                     299 ___str_9:
   0182 2E                  300 	.ascii "."
   0183 00                  301 	.db 0x00
   0184                     302 ___str_11:
   0184 0D                  303 	.db 0x0d
   0185 00                  304 	.db 0x00
                            305 ;../generic/usbdisk.c:73: select_mode_t usbdisk_select_dsk_file (char* start_directory)
                            306 ;	---------------------------------
                            307 ; Function usbdisk_select_dsk_file
                            308 ; ---------------------------------
   0186                     309 _usbdisk_select_dsk_file::
   0186 DD E5         [15]  310 	push	ix
   0188 DD 21 00 00   [14]  311 	ld	ix,#0
   018C DD 39         [15]  312 	add	ix,sp
   018E 21 92 FE      [10]  313 	ld	hl, #-366
   0191 39            [11]  314 	add	hl, sp
   0192 F9            [ 6]  315 	ld	sp, hl
                            316 ;../generic/usbdisk.c:81: if (supports_80_column_mode())
   0193 CDr00r00      [17]  317 	call	_supports_80_column_mode
   0196 CB 45         [ 8]  318 	bit	0, l
   0198 28 06         [12]  319 	jr	Z,00102$
                            320 ;../generic/usbdisk.c:82: nr_dsks_per_line = 5;
   019A DD 36 F3 05   [19]  321 	ld	-13 (ix), #0x05
   019E 18 04         [12]  322 	jr	00103$
   01A0                     323 00102$:
                            324 ;../generic/usbdisk.c:84: nr_dsks_per_line = 2;
   01A0 DD 36 F3 02   [19]  325 	ld	-13 (ix), #0x02
   01A4                     326 00103$:
                            327 ;../generic/usbdisk.c:86: nr_dsk_files_found=0;
   01A4 AF            [ 4]  328 	xor	a, a
   01A5 DD 77 FE      [19]  329 	ld	-2 (ix), a
                            330 ;../generic/usbdisk.c:89: ch376_set_filename (start_directory);
   01A8 DD 6E 04      [19]  331 	ld	l, 4 (ix)
   01AB DD 66 05      [19]  332 	ld	h, 5 (ix)
   01AE E5            [11]  333 	push	hl
   01AF CDr00r00      [17]  334 	call	_ch376_set_filename
   01B2 F1            [10]  335 	pop	af
                            336 ;../generic/usbdisk.c:90: if (!ch376_open_directory())
   01B3 CDr00r00      [17]  337 	call	_ch376_open_directory
   01B6 CB 45         [ 8]  338 	bit	0, l
   01B8 20 08         [12]  339 	jr	NZ,00105$
                            340 ;../generic/usbdisk.c:92: error ("-Directory not opened");
   01BA 21r96r04      [10]  341 	ld	hl, #___str_12
   01BD E5            [11]  342 	push	hl
   01BE CDr00r00      [17]  343 	call	_error
   01C1 F1            [10]  344 	pop	af
   01C2                     345 00105$:
                            346 ;../generic/usbdisk.c:97: printf ("1.FLOPPY       2.USBDRIVE\r\n\r\n");
   01C2 21rF1r04      [10]  347 	ld	hl, #___str_24
   01C5 E5            [11]  348 	push	hl
   01C6 CDr00r00      [17]  349 	call	_puts
                            350 ;../generic/usbdisk.c:100: ch376_set_filename ("*");
   01C9 21rACr04      [10]  351 	ld	hl, #___str_17
   01CC E3            [19]  352 	ex	(sp),hl
   01CD CDr00r00      [17]  353 	call	_ch376_set_filename
   01D0 F1            [10]  354 	pop	af
                            355 ;../generic/usbdisk.c:101: if (!ch376_open_search ())
   01D1 CDr00r00      [17]  356 	call	_ch376_open_search
   01D4 CB 45         [ 8]  357 	bit	0, l
   01D6 20 08         [12]  358 	jr	NZ,00107$
                            359 ;../generic/usbdisk.c:102: error ("-No files found");
   01D8 21rAEr04      [10]  360 	ld	hl, #___str_18
   01DB E5            [11]  361 	push	hl
   01DC CDr00r00      [17]  362 	call	_error
   01DF F1            [10]  363 	pop	af
   01E0                     364 00107$:
                            365 ;../generic/usbdisk.c:104: printf ("Or, select DSK image [%s]:\r\n",start_directory);
   01E0 DD 6E 04      [19]  366 	ld	l, 4 (ix)
   01E3 DD 66 05      [19]  367 	ld	h, 5 (ix)
   01E6 E5            [11]  368 	push	hl
   01E7 21rBEr04      [10]  369 	ld	hl, #___str_19
   01EA E5            [11]  370 	push	hl
   01EB CDr00r00      [17]  371 	call	_printf
   01EE F1            [10]  372 	pop	af
   01EF F1            [10]  373 	pop	af
                            374 ;../generic/usbdisk.c:106: do 
   01F0 21 20 00      [10]  375 	ld	hl, #32
   01F3 39            [11]  376 	add	hl, sp
   01F4 DD 75 F4      [19]  377 	ld	-12 (ix), l
   01F7 DD 74 F5      [19]  378 	ld	-11 (ix), h
   01FA DD 7E F4      [19]  379 	ld	a, -12 (ix)
   01FD DD 77 F6      [19]  380 	ld	-10 (ix), a
   0200 DD 7E F5      [19]  381 	ld	a, -11 (ix)
   0203 DD 77 F7      [19]  382 	ld	-9 (ix), a
   0206 21 00 00      [10]  383 	ld	hl, #0
   0209 39            [11]  384 	add	hl, sp
   020A DD 75 F8      [19]  385 	ld	-8 (ix), l
   020D DD 74 F9      [19]  386 	ld	-7 (ix), h
   0210 DD 7E F8      [19]  387 	ld	a, -8 (ix)
   0213 C6 0B         [ 7]  388 	add	a, #0x0b
   0215 DD 77 FA      [19]  389 	ld	-6 (ix), a
   0218 DD 7E F9      [19]  390 	ld	a, -7 (ix)
   021B CE 00         [ 7]  391 	adc	a, #0x00
   021D DD 77 FB      [19]  392 	ld	-5 (ix), a
   0220                     393 00128$:
                            394 ;../generic/usbdisk.c:108: ch376_get_fat_info (&info);
   0220 DD 4E F8      [19]  395 	ld	c, -8 (ix)
   0223 DD 46 F9      [19]  396 	ld	b, -7 (ix)
   0226 C5            [11]  397 	push	bc
   0227 CDr00r00      [17]  398 	call	_ch376_get_fat_info
   022A F1            [10]  399 	pop	af
                            400 ;../generic/usbdisk.c:109: if (!(info.DIR_Attr&0x02)) // show non-hidden normal or archived files
   022B DD 6E FA      [19]  401 	ld	l, -6 (ix)
   022E DD 66 FB      [19]  402 	ld	h, -5 (ix)
   0231 7E            [ 7]  403 	ld	a, (hl)
   0232 DD 77 FF      [19]  404 	ld	-1 (ix), a
   0235 DD CB FF 4E   [20]  405 	bit	1, -1 (ix)
   0239 C2rD9r03      [10]  406 	jp	NZ,00129$
                            407 ;../generic/usbdisk.c:111: if (info.DIR_Attr&0x20 || info.DIR_Attr==0x00)
   023C DD CB FF 6E   [20]  408 	bit	5, -1 (ix)
   0240 20 07         [12]  409 	jr	NZ,00117$
   0242 DD 7E FF      [19]  410 	ld	a, -1 (ix)
   0245 B7            [ 4]  411 	or	a, a
   0246 C2r19r03      [10]  412 	jp	NZ, 00118$
   0249                     413 00117$:
                            414 ;../generic/usbdisk.c:113: if (info.DIR_Name[8]=='D' &&
   0249 DD 6E F8      [19]  415 	ld	l, -8 (ix)
   024C DD 66 F9      [19]  416 	ld	h, -7 (ix)
   024F 11 08 00      [10]  417 	ld	de, #0x0008
   0252 19            [11]  418 	add	hl, de
   0253 7E            [ 7]  419 	ld	a, (hl)
   0254 D6 44         [ 7]  420 	sub	a, #0x44
   0256 C2r19r03      [10]  421 	jp	NZ,00118$
                            422 ;../generic/usbdisk.c:114: info.DIR_Name[9]=='S' &&
   0259 DD 6E F8      [19]  423 	ld	l, -8 (ix)
   025C DD 66 F9      [19]  424 	ld	h, -7 (ix)
   025F 11 09 00      [10]  425 	ld	de, #0x0009
   0262 19            [11]  426 	add	hl, de
   0263 7E            [ 7]  427 	ld	a, (hl)
   0264 D6 53         [ 7]  428 	sub	a, #0x53
   0266 C2r19r03      [10]  429 	jp	NZ,00118$
                            430 ;../generic/usbdisk.c:115: info.DIR_Name[10]=='K')
   0269 DD 6E F8      [19]  431 	ld	l, -8 (ix)
   026C DD 66 F9      [19]  432 	ld	h, -7 (ix)
   026F 11 0A 00      [10]  433 	ld	de, #0x000a
   0272 19            [11]  434 	add	hl, de
   0273 7E            [ 7]  435 	ld	a, (hl)
   0274 D6 4B         [ 7]  436 	sub	a, #0x4b
   0276 C2r19r03      [10]  437 	jp	NZ,00118$
                            438 ;../generic/usbdisk.c:117: putchar ('A'+nr_dsk_files_found);
   0279 DD 4E FE      [19]  439 	ld	c, -2 (ix)
   027C 06 00         [ 7]  440 	ld	b, #0x00
   027E 21 41 00      [10]  441 	ld	hl, #0x0041
   0281 09            [11]  442 	add	hl, bc
   0282 E5            [11]  443 	push	hl
   0283 CDr00r00      [17]  444 	call	_putchar
                            445 ;../generic/usbdisk.c:118: putchar ('.');
   0286 21 2E 00      [10]  446 	ld	hl, #0x002e
   0289 E3            [19]  447 	ex	(sp),hl
   028A CDr00r00      [17]  448 	call	_putchar
   028D F1            [10]  449 	pop	af
                            450 ;../generic/usbdisk.c:119: files[nr_dsk_files_found][11]='\0';
   028E DD 4E FE      [19]  451 	ld	c, -2 (ix)
   0291 06 00         [ 7]  452 	ld	b, #0x00
   0293 69            [ 4]  453 	ld	l, c
   0294 60            [ 4]  454 	ld	h, b
   0295 29            [11]  455 	add	hl, hl
   0296 09            [11]  456 	add	hl, bc
   0297 29            [11]  457 	add	hl, hl
   0298 29            [11]  458 	add	hl, hl
   0299 EB            [ 4]  459 	ex	de, hl
   029A DD 7E F4      [19]  460 	ld	a, -12 (ix)
   029D 83            [ 4]  461 	add	a, e
   029E 4F            [ 4]  462 	ld	c, a
   029F DD 7E F5      [19]  463 	ld	a, -11 (ix)
   02A2 8A            [ 4]  464 	adc	a, d
   02A3 47            [ 4]  465 	ld	b, a
   02A4 21 0B 00      [10]  466 	ld	hl, #0x000b
   02A7 09            [11]  467 	add	hl, bc
   02A8 36 00         [10]  468 	ld	(hl), #0x00
                            469 ;../generic/usbdisk.c:120: for (cnt=0;cnt<11;cnt++)
   02AA DD 71 FC      [19]  470 	ld	-4 (ix), c
   02AD DD 70 FD      [19]  471 	ld	-3 (ix), b
   02B0 0E 00         [ 7]  472 	ld	c, #0x00
   02B2                     473 00149$:
                            474 ;../generic/usbdisk.c:122: if (cnt==8)
   02B2 79            [ 4]  475 	ld	a, c
   02B3 D6 08         [ 7]  476 	sub	a, #0x08
   02B5 20 0A         [12]  477 	jr	NZ,00109$
                            478 ;../generic/usbdisk.c:123: putchar ('.');
   02B7 C5            [11]  479 	push	bc
   02B8 21 2E 00      [10]  480 	ld	hl, #0x002e
   02BB E5            [11]  481 	push	hl
   02BC CDr00r00      [17]  482 	call	_putchar
   02BF F1            [10]  483 	pop	af
   02C0 C1            [10]  484 	pop	bc
   02C1                     485 00109$:
                            486 ;../generic/usbdisk.c:124: putchar (info.DIR_Name[cnt]);
   02C1 DD 7E F8      [19]  487 	ld	a, -8 (ix)
   02C4 81            [ 4]  488 	add	a, c
   02C5 5F            [ 4]  489 	ld	e, a
   02C6 DD 7E F9      [19]  490 	ld	a, -7 (ix)
   02C9 CE 00         [ 7]  491 	adc	a, #0x00
   02CB 57            [ 4]  492 	ld	d, a
   02CC 1A            [ 7]  493 	ld	a, (de)
   02CD 6F            [ 4]  494 	ld	l, a
   02CE 26 00         [ 7]  495 	ld	h, #0x00
   02D0 C5            [11]  496 	push	bc
   02D1 D5            [11]  497 	push	de
   02D2 E5            [11]  498 	push	hl
   02D3 CDr00r00      [17]  499 	call	_putchar
   02D6 F1            [10]  500 	pop	af
   02D7 D1            [10]  501 	pop	de
   02D8 C1            [10]  502 	pop	bc
                            503 ;../generic/usbdisk.c:125: files[nr_dsk_files_found][cnt]=info.DIR_Name[cnt];
   02D9 DD 7E FC      [19]  504 	ld	a, -4 (ix)
   02DC 81            [ 4]  505 	add	a, c
   02DD 47            [ 4]  506 	ld	b, a
   02DE DD 7E FD      [19]  507 	ld	a, -3 (ix)
   02E1 CE 00         [ 7]  508 	adc	a, #0x00
   02E3 F5            [11]  509 	push	af
   02E4 1A            [ 7]  510 	ld	a, (de)
   02E5 5F            [ 4]  511 	ld	e, a
   02E6 F1            [10]  512 	pop	af
   02E7 68            [ 4]  513 	ld	l, b
   02E8 67            [ 4]  514 	ld	h, a
   02E9 73            [ 7]  515 	ld	(hl), e
                            516 ;../generic/usbdisk.c:120: for (cnt=0;cnt<11;cnt++)
   02EA 0C            [ 4]  517 	inc	c
   02EB 79            [ 4]  518 	ld	a, c
   02EC D6 0B         [ 7]  519 	sub	a, #0x0b
   02EE 38 C2         [12]  520 	jr	C,00149$
                            521 ;../generic/usbdisk.c:127: putchar (' ');
   02F0 21 20 00      [10]  522 	ld	hl, #0x0020
   02F3 E5            [11]  523 	push	hl
   02F4 CDr00r00      [17]  524 	call	_putchar
   02F7 F1            [10]  525 	pop	af
                            526 ;../generic/usbdisk.c:128: nr_dsk_files_found++;
   02F8 DD 34 FE      [23]  527 	inc	-2 (ix)
                            528 ;../generic/usbdisk.c:129: if ((nr_dsk_files_found%nr_dsks_per_line) == 0)
   02FB DD 66 F3      [19]  529 	ld	h, -13 (ix)
   02FE DD 6E FE      [19]  530 	ld	l, -2 (ix)
   0301 E5            [11]  531 	push	hl
   0302 CDr00r00      [17]  532 	call	__moduchar
   0305 F1            [10]  533 	pop	af
   0306 7D            [ 4]  534 	ld	a, l
   0307 B7            [ 4]  535 	or	a, a
   0308 20 0F         [12]  536 	jr	NZ,00118$
                            537 ;../generic/usbdisk.c:131: putchar ('\r');
   030A 21 0D 00      [10]  538 	ld	hl, #0x000d
   030D E5            [11]  539 	push	hl
   030E CDr00r00      [17]  540 	call	_putchar
                            541 ;../generic/usbdisk.c:132: putchar ('\n');
   0311 21 0A 00      [10]  542 	ld	hl, #0x000a
   0314 E3            [19]  543 	ex	(sp),hl
   0315 CDr00r00      [17]  544 	call	_putchar
   0318 F1            [10]  545 	pop	af
   0319                     546 00118$:
                            547 ;../generic/usbdisk.c:136: if (info.DIR_Attr&0x10)
   0319 DD 6E FA      [19]  548 	ld	l, -6 (ix)
   031C DD 66 FB      [19]  549 	ld	h, -5 (ix)
   031F CB 66         [12]  550 	bit	4, (hl)
   0321 CArD9r03      [10]  551 	jp	Z,00129$
                            552 ;../generic/usbdisk.c:138: putchar ('A'+nr_dsk_files_found);
   0324 DD 4E FE      [19]  553 	ld	c, -2 (ix)
   0327 06 00         [ 7]  554 	ld	b, #0x00
   0329 21 41 00      [10]  555 	ld	hl, #0x0041
   032C 09            [11]  556 	add	hl, bc
   032D E5            [11]  557 	push	hl
   032E CDr00r00      [17]  558 	call	_putchar
                            559 ;../generic/usbdisk.c:139: putchar ('.');
   0331 21 2E 00      [10]  560 	ld	hl, #0x002e
   0334 E3            [19]  561 	ex	(sp),hl
   0335 CDr00r00      [17]  562 	call	_putchar
                            563 ;../generic/usbdisk.c:140: putchar ('\\');
   0338 21 5C 00      [10]  564 	ld	hl, #0x005c
   033B E3            [19]  565 	ex	(sp),hl
   033C CDr00r00      [17]  566 	call	_putchar
   033F F1            [10]  567 	pop	af
                            568 ;../generic/usbdisk.c:141: files[nr_dsk_files_found][8]='\0';
   0340 DD 4E FE      [19]  569 	ld	c, -2 (ix)
   0343 06 00         [ 7]  570 	ld	b, #0x00
   0345 69            [ 4]  571 	ld	l, c
   0346 60            [ 4]  572 	ld	h, b
   0347 29            [11]  573 	add	hl, hl
   0348 09            [11]  574 	add	hl, bc
   0349 29            [11]  575 	add	hl, hl
   034A 29            [11]  576 	add	hl, hl
   034B EB            [ 4]  577 	ex	de, hl
   034C DD 7E F6      [19]  578 	ld	a, -10 (ix)
   034F 83            [ 4]  579 	add	a, e
   0350 4F            [ 4]  580 	ld	c, a
   0351 DD 7E F7      [19]  581 	ld	a, -9 (ix)
   0354 8A            [ 4]  582 	adc	a, d
   0355 47            [ 4]  583 	ld	b, a
   0356 21 08 00      [10]  584 	ld	hl, #0x0008
   0359 09            [11]  585 	add	hl, bc
   035A 36 00         [10]  586 	ld	(hl), #0x00
                            587 ;../generic/usbdisk.c:142: for (cnt=0;cnt<8;cnt++)
   035C DD 71 FC      [19]  588 	ld	-4 (ix), c
   035F DD 70 FD      [19]  589 	ld	-3 (ix), b
   0362 AF            [ 4]  590 	xor	a, a
   0363 DD 77 FF      [19]  591 	ld	-1 (ix), a
   0366                     592 00151$:
                            593 ;../generic/usbdisk.c:144: putchar (tolower(info.DIR_Name[cnt]));
   0366 DD 7E F8      [19]  594 	ld	a, -8 (ix)
   0369 DD 86 FF      [19]  595 	add	a, -1 (ix)
   036C 4F            [ 4]  596 	ld	c, a
   036D DD 7E F9      [19]  597 	ld	a, -7 (ix)
   0370 CE 00         [ 7]  598 	adc	a, #0x00
   0372 47            [ 4]  599 	ld	b, a
   0373 0A            [ 7]  600 	ld	a, (bc)
   0374 5F            [ 4]  601 	ld	e, a
   0375 16 00         [ 7]  602 	ld	d, #0x00
   0377 C5            [11]  603 	push	bc
   0378 D5            [11]  604 	push	de
   0379 CDr00r00      [17]  605 	call	_tolower
   037C E3            [19]  606 	ex	(sp),hl
   037D CDr00r00      [17]  607 	call	_putchar
   0380 F1            [10]  608 	pop	af
   0381 C1            [10]  609 	pop	bc
                            610 ;../generic/usbdisk.c:145: files[nr_dsk_files_found][cnt]=info.DIR_Name[cnt];
   0382 DD 7E FC      [19]  611 	ld	a, -4 (ix)
   0385 DD 86 FF      [19]  612 	add	a, -1 (ix)
   0388 5F            [ 4]  613 	ld	e, a
   0389 DD 7E FD      [19]  614 	ld	a, -3 (ix)
   038C CE 00         [ 7]  615 	adc	a, #0x00
   038E 57            [ 4]  616 	ld	d, a
   038F 0A            [ 7]  617 	ld	a, (bc)
   0390 12            [ 7]  618 	ld	(de), a
                            619 ;../generic/usbdisk.c:142: for (cnt=0;cnt<8;cnt++)
   0391 DD 34 FF      [23]  620 	inc	-1 (ix)
   0394 DD 7E FF      [19]  621 	ld	a, -1 (ix)
   0397 D6 08         [ 7]  622 	sub	a, #0x08
   0399 38 CB         [12]  623 	jr	C,00151$
                            624 ;../generic/usbdisk.c:147: putchar (' ');
   039B 21 20 00      [10]  625 	ld	hl, #0x0020
   039E E5            [11]  626 	push	hl
   039F CDr00r00      [17]  627 	call	_putchar
                            628 ;../generic/usbdisk.c:148: putchar (' ');
   03A2 21 20 00      [10]  629 	ld	hl, #0x0020
   03A5 E3            [19]  630 	ex	(sp),hl
   03A6 CDr00r00      [17]  631 	call	_putchar
                            632 ;../generic/usbdisk.c:149: putchar (' ');
   03A9 21 20 00      [10]  633 	ld	hl, #0x0020
   03AC E3            [19]  634 	ex	(sp),hl
   03AD CDr00r00      [17]  635 	call	_putchar
                            636 ;../generic/usbdisk.c:150: putchar (' ');
   03B0 21 20 00      [10]  637 	ld	hl, #0x0020
   03B3 E3            [19]  638 	ex	(sp),hl
   03B4 CDr00r00      [17]  639 	call	_putchar
   03B7 F1            [10]  640 	pop	af
                            641 ;../generic/usbdisk.c:151: nr_dsk_files_found++;
   03B8 DD 34 FE      [23]  642 	inc	-2 (ix)
                            643 ;../generic/usbdisk.c:152: if ((nr_dsk_files_found%nr_dsks_per_line) == 0)
   03BB DD 66 F3      [19]  644 	ld	h, -13 (ix)
   03BE DD 6E FE      [19]  645 	ld	l, -2 (ix)
   03C1 E5            [11]  646 	push	hl
   03C2 CDr00r00      [17]  647 	call	__moduchar
   03C5 F1            [10]  648 	pop	af
   03C6 7D            [ 4]  649 	ld	a, l
   03C7 B7            [ 4]  650 	or	a, a
   03C8 20 0F         [12]  651 	jr	NZ,00129$
                            652 ;../generic/usbdisk.c:154: putchar ('\r');
   03CA 21 0D 00      [10]  653 	ld	hl, #0x000d
   03CD E5            [11]  654 	push	hl
   03CE CDr00r00      [17]  655 	call	_putchar
                            656 ;../generic/usbdisk.c:155: putchar ('\n');
   03D1 21 0A 00      [10]  657 	ld	hl, #0x000a
   03D4 E3            [19]  658 	ex	(sp),hl
   03D5 CDr00r00      [17]  659 	call	_putchar
   03D8 F1            [10]  660 	pop	af
   03D9                     661 00129$:
                            662 ;../generic/usbdisk.c:160: while (ch376_next_search () && nr_dsk_files_found<MAX_FILES);
   03D9 CDr00r00      [17]  663 	call	_ch376_next_search
   03DC CB 45         [ 8]  664 	bit	0, l
   03DE 28 08         [12]  665 	jr	Z,00130$
   03E0 DD 7E FE      [19]  666 	ld	a, -2 (ix)
   03E3 D6 1A         [ 7]  667 	sub	a, #0x1a
   03E5 DAr20r02      [10]  668 	jp	C, 00128$
   03E8                     669 00130$:
                            670 ;../generic/usbdisk.c:161: putchar ('\r');
   03E8 21 0D 00      [10]  671 	ld	hl, #0x000d
   03EB E5            [11]  672 	push	hl
   03EC CDr00r00      [17]  673 	call	_putchar
                            674 ;../generic/usbdisk.c:162: putchar ('\n');
   03EF 21 0A 00      [10]  675 	ld	hl, #0x000a
   03F2 E3            [19]  676 	ex	(sp),hl
   03F3 CDr00r00      [17]  677 	call	_putchar
                            678 ;../generic/usbdisk.c:164: printf ("\r\n");
   03F6 21rDBr04      [10]  679 	ld	hl, #___str_21
   03F9 E3            [19]  680 	ex	(sp),hl
   03FA CDr00r00      [17]  681 	call	_puts
   03FD F1            [10]  682 	pop	af
                            683 ;../generic/usbdisk.c:165: while (true)
   03FE                     684 00147$:
                            685 ;../generic/usbdisk.c:167: char c = getchar ();
   03FE CDr00r00      [17]  686 	call	_getchar
                            687 ;../generic/usbdisk.c:168: c = toupper (c);
   0401 26 00         [ 7]  688 	ld	h, #0x00
   0403 E5            [11]  689 	push	hl
   0404 CDr00r00      [17]  690 	call	_toupper
   0407 F1            [10]  691 	pop	af
                            692 ;../generic/usbdisk.c:169: if (c>='A' && c<='A'+nr_dsk_files_found)
   0408 DD 75 FF      [19]  693 	ld	-1 (ix), l
   040B 7D            [ 4]  694 	ld	a, l
   040C D6 41         [ 7]  695 	sub	a, #0x41
   040E 38 6D         [12]  696 	jr	C,00140$
   0410 DD 4E FE      [19]  697 	ld	c, -2 (ix)
   0413 06 00         [ 7]  698 	ld	b, #0x00
   0415 21 41 00      [10]  699 	ld	hl, #0x0041
   0418 09            [11]  700 	add	hl, bc
   0419 DD 4E FF      [19]  701 	ld	c, -1 (ix)
   041C 06 00         [ 7]  702 	ld	b, #0x00
   041E 7D            [ 4]  703 	ld	a, l
   041F 91            [ 4]  704 	sub	a, c
   0420 7C            [ 4]  705 	ld	a, h
   0421 98            [ 4]  706 	sbc	a, b
   0422 E2r27r04      [10]  707 	jp	PO, 00300$
   0425 EE 80         [ 7]  708 	xor	a, #0x80
   0427                     709 00300$:
   0427 FAr7Dr04      [10]  710 	jp	M, 00140$
                            711 ;../generic/usbdisk.c:171: c-='A';
   042A DD 7E FF      [19]  712 	ld	a, -1 (ix)
   042D C6 BF         [ 7]  713 	add	a, #0xbf
                            714 ;../generic/usbdisk.c:172: if (files[c][8]=='\0')
   042F 4F            [ 4]  715 	ld	c, a
   0430 06 00         [ 7]  716 	ld	b, #0x00
   0432 69            [ 4]  717 	ld	l, c
   0433 60            [ 4]  718 	ld	h, b
   0434 29            [11]  719 	add	hl, hl
   0435 09            [11]  720 	add	hl, bc
   0436 29            [11]  721 	add	hl, hl
   0437 29            [11]  722 	add	hl, hl
   0438 EB            [ 4]  723 	ex	de, hl
   0439 DD 7E F4      [19]  724 	ld	a, -12 (ix)
   043C 83            [ 4]  725 	add	a, e
   043D 5F            [ 4]  726 	ld	e, a
   043E DD 7E F5      [19]  727 	ld	a, -11 (ix)
   0441 8A            [ 4]  728 	adc	a, d
   0442 57            [ 4]  729 	ld	d, a
   0443 6B            [ 4]  730 	ld	l, e
   0444 62            [ 4]  731 	ld	h, d
   0445 01 08 00      [10]  732 	ld	bc, #0x0008
   0448 09            [11]  733 	add	hl, bc
   0449 7E            [ 7]  734 	ld	a, (hl)
                            735 ;../generic/usbdisk.c:178: return usbdisk_select_dsk_file (files[c]);
   044A 4B            [ 4]  736 	ld	c, e
   044B 42            [ 4]  737 	ld	b, d
                            738 ;../generic/usbdisk.c:172: if (files[c][8]=='\0')
   044C B7            [ 4]  739 	or	a, a
   044D 20 16         [12]  740 	jr	NZ,00137$
                            741 ;../generic/usbdisk.c:175: if (files[c][0]=='.')
   044F 1A            [ 7]  742 	ld	a, (de)
   0450 D6 2E         [ 7]  743 	sub	a, #0x2e
   0452 20 0A         [12]  744 	jr	NZ,00132$
                            745 ;../generic/usbdisk.c:176: return usbdisk_select_dsk_file ("/");
   0454 21rDDr04      [10]  746 	ld	hl, #___str_22
   0457 E5            [11]  747 	push	hl
   0458 CDr86r01      [17]  748 	call	_usbdisk_select_dsk_file
   045B F1            [10]  749 	pop	af
   045C 18 33         [12]  750 	jr	00153$
   045E                     751 00132$:
                            752 ;../generic/usbdisk.c:178: return usbdisk_select_dsk_file (files[c]);
   045E C5            [11]  753 	push	bc
   045F CDr86r01      [17]  754 	call	_usbdisk_select_dsk_file
   0462 F1            [10]  755 	pop	af
   0463 18 2C         [12]  756 	jr	00153$
   0465                     757 00137$:
                            758 ;../generic/usbdisk.c:183: ch376_set_filename (files[c]);
   0465 C5            [11]  759 	push	bc
   0466 CDr00r00      [17]  760 	call	_ch376_set_filename
   0469 F1            [10]  761 	pop	af
                            762 ;../generic/usbdisk.c:184: if (!ch376_open_file ())
   046A CDr00r00      [17]  763 	call	_ch376_open_file
   046D CB 45         [ 8]  764 	bit	0, l
   046F 20 08         [12]  765 	jr	NZ,00135$
                            766 ;../generic/usbdisk.c:185: error ("-DSK not opened\r\n");
   0471 21rDFr04      [10]  767 	ld	hl, #___str_23
   0474 E5            [11]  768 	push	hl
   0475 CDr00r00      [17]  769 	call	_error
   0478 F1            [10]  770 	pop	af
   0479                     771 00135$:
                            772 ;../generic/usbdisk.c:186: return DSK_IMAGE;
   0479 2E 02         [ 7]  773 	ld	l, #0x02
   047B 18 14         [12]  774 	jr	00153$
   047D                     775 00140$:
                            776 ;../generic/usbdisk.c:189: if (c=='1')
   047D DD 7E FF      [19]  777 	ld	a, -1 (ix)
                            778 ;../generic/usbdisk.c:190: return FLOPPY;
   0480 D6 31         [ 7]  779 	sub	a,#0x31
   0482 20 03         [12]  780 	jr	NZ,00143$
   0484 6F            [ 4]  781 	ld	l,a
   0485 18 0A         [12]  782 	jr	00153$
   0487                     783 00143$:
                            784 ;../generic/usbdisk.c:191: if (c=='2')
   0487 DD 7E FF      [19]  785 	ld	a, -1 (ix)
   048A D6 32         [ 7]  786 	sub	a, #0x32
   048C C2rFEr03      [10]  787 	jp	NZ,00147$
                            788 ;../generic/usbdisk.c:192: return USB;
   048F 2E 01         [ 7]  789 	ld	l, #0x01
   0491                     790 00153$:
                            791 ;../generic/usbdisk.c:194: }
   0491 DD F9         [10]  792 	ld	sp, ix
   0493 DD E1         [14]  793 	pop	ix
   0495 C9            [10]  794 	ret
   0496                     795 ___str_12:
   0496 2D 44 69 72 65 63   796 	.ascii "-Directory not opened"
        74 6F 72 79 20 6E
        6F 74 20 6F 70 65
        6E 65 64
   04AB 00                  797 	.db 0x00
   04AC                     798 ___str_17:
   04AC 2A                  799 	.ascii "*"
   04AD 00                  800 	.db 0x00
   04AE                     801 ___str_18:
   04AE 2D 4E 6F 20 66 69   802 	.ascii "-No files found"
        6C 65 73 20 66 6F
        75 6E 64
   04BD 00                  803 	.db 0x00
   04BE                     804 ___str_19:
   04BE 4F 72 2C 20 73 65   805 	.ascii "Or, select DSK image [%s]:"
        6C 65 63 74 20 44
        53 4B 20 69 6D 61
        67 65 20 5B 25 73
        5D 3A
   04D8 0D                  806 	.db 0x0d
   04D9 0A                  807 	.db 0x0a
   04DA 00                  808 	.db 0x00
   04DB                     809 ___str_21:
   04DB 0D                  810 	.db 0x0d
   04DC 00                  811 	.db 0x00
   04DD                     812 ___str_22:
   04DD 2F                  813 	.ascii "/"
   04DE 00                  814 	.db 0x00
   04DF                     815 ___str_23:
   04DF 2D 44 53 4B 20 6E   816 	.ascii "-DSK not opened"
        6F 74 20 6F 70 65
        6E 65 64
   04EE 0D                  817 	.db 0x0d
   04EF 0A                  818 	.db 0x0a
   04F0 00                  819 	.db 0x00
   04F1                     820 ___str_24:
   04F1 0D                  821 	.db 0x0d
   04F2 0A                  822 	.db 0x0a
   04F3 53 65 6C 65 63 74   823 	.ascii "Select device:"
        20 64 65 76 69 63
        65 3A
   0501 0D                  824 	.db 0x0d
   0502 0A                  825 	.db 0x0a
   0503 31 2E 46 4C 4F 50   826 	.ascii "1.FLOPPY       2.USBDRIVE"
        50 59 20 20 20 20
        20 20 20 32 2E 55
        53 42 44 52 49 56
        45
   051C 0D                  827 	.db 0x0d
   051D 0A                  828 	.db 0x0a
   051E 0D                  829 	.db 0x0d
   051F 00                  830 	.db 0x00
                            831 ;../generic/usbdisk.c:196: bool read_write_file_sectors (bool writing,uint8_t nr_sectors,uint32_t* sector,uint8_t* sector_buffer)
                            832 ;	---------------------------------
                            833 ; Function read_write_file_sectors
                            834 ; ---------------------------------
   0520                     835 _read_write_file_sectors::
   0520 21 F6 FF      [10]  836 	ld	hl, #-10
   0523 39            [11]  837 	add	hl, sp
   0524 F9            [ 6]  838 	ld	sp, hl
                            839 ;../generic/usbdisk.c:199: if (!ch376_locate_sector ((uint8_t*)sector))
   0525 21 0E 00      [10]  840 	ld	hl, #14
   0528 39            [11]  841 	add	hl, sp
   0529 4E            [ 7]  842 	ld	c, (hl)
   052A 23            [ 6]  843 	inc	hl
   052B 46            [ 7]  844 	ld	b, (hl)
   052C C5            [11]  845 	push	bc
   052D CDr00r00      [17]  846 	call	_ch376_locate_sector
   0530 F1            [10]  847 	pop	af
   0531 4D            [ 4]  848 	ld	c, l
   0532 CB 41         [ 8]  849 	bit	0, c
   0534 20 05         [12]  850 	jr	NZ,00102$
                            851 ;../generic/usbdisk.c:200: return false;
   0536 2E 00         [ 7]  852 	ld	l, #0x00
   0538 C3rBBr05      [10]  853 	jp	00112$
   053B                     854 00102$:
                            855 ;../generic/usbdisk.c:201: if (!ch376_get_sector_LBA (nr_sectors,(uint8_t*) &sectors_lba))
   053B 21 00 00      [10]  856 	ld	hl, #0
   053E 39            [11]  857 	add	hl, sp
   053F FD 21 08 00   [14]  858 	ld	iy, #8
   0543 FD 39         [15]  859 	add	iy, sp
   0545 FD 75 00      [19]  860 	ld	0 (iy), l
   0548 FD 74 01      [19]  861 	ld	1 (iy), h
   054B FD 4E 00      [19]  862 	ld	c, 0 (iy)
   054E FD 46 01      [19]  863 	ld	b, 1 (iy)
   0551 C5            [11]  864 	push	bc
   0552 21 0F 00      [10]  865 	ld	hl, #15+0
   0555 39            [11]  866 	add	hl, sp
   0556 7E            [ 7]  867 	ld	a, (hl)
   0557 F5            [11]  868 	push	af
   0558 33            [ 6]  869 	inc	sp
   0559 CDr00r00      [17]  870 	call	_ch376_get_sector_LBA
   055C F1            [10]  871 	pop	af
   055D 33            [ 6]  872 	inc	sp
   055E CB 45         [ 8]  873 	bit	0, l
   0560 20 04         [12]  874 	jr	NZ,00104$
                            875 ;../generic/usbdisk.c:202: return false;
   0562 2E 00         [ 7]  876 	ld	l, #0x00
   0564 18 55         [12]  877 	jr	00112$
   0566                     878 00104$:
                            879 ;../generic/usbdisk.c:205: if (!ch376s_disk_read (sectors_lba[0],sectors_lba+4,sector_buffer))
   0566 FD 21 08 00   [14]  880 	ld	iy, #8
   056A FD 39         [15]  881 	add	iy, sp
   056C FD 7E 00      [19]  882 	ld	a, 0 (iy)
   056F C6 04         [ 7]  883 	add	a, #0x04
   0571 4F            [ 4]  884 	ld	c, a
   0572 FD 7E 01      [19]  885 	ld	a, 1 (iy)
   0575 CE 00         [ 7]  886 	adc	a, #0x00
   0577 FD 6E 00      [19]  887 	ld	l, 0 (iy)
   057A FD 66 01      [19]  888 	ld	h, 1 (iy)
   057D 56            [ 7]  889 	ld	d, (hl)
   057E 47            [ 4]  890 	ld	b, a
                            891 ;../generic/usbdisk.c:203: if (!writing)
   057F 21 0C 00      [10]  892 	ld	hl, #12+0
   0582 39            [11]  893 	add	hl, sp
   0583 CB 46         [12]  894 	bit	0, (hl)
   0585 20 1A         [12]  895 	jr	NZ,00110$
                            896 ;../generic/usbdisk.c:205: if (!ch376s_disk_read (sectors_lba[0],sectors_lba+4,sector_buffer))
   0587 21 10 00      [10]  897 	ld	hl, #16
   058A 39            [11]  898 	add	hl, sp
   058B 7E            [ 7]  899 	ld	a, (hl)
   058C 23            [ 6]  900 	inc	hl
   058D 66            [ 7]  901 	ld	h, (hl)
   058E 6F            [ 4]  902 	ld	l, a
   058F E5            [11]  903 	push	hl
   0590 C5            [11]  904 	push	bc
   0591 D5            [11]  905 	push	de
   0592 33            [ 6]  906 	inc	sp
   0593 CDr00r00      [17]  907 	call	_ch376s_disk_read
   0596 F1            [10]  908 	pop	af
   0597 F1            [10]  909 	pop	af
   0598 33            [ 6]  910 	inc	sp
   0599 CB 45         [ 8]  911 	bit	0, l
   059B 20 1C         [12]  912 	jr	NZ,00111$
                            913 ;../generic/usbdisk.c:206: return false;
   059D 2E 00         [ 7]  914 	ld	l, #0x00
   059F 18 1A         [12]  915 	jr	00112$
   05A1                     916 00110$:
                            917 ;../generic/usbdisk.c:210: if (!ch376s_disk_write (sectors_lba[0],sectors_lba+4,sector_buffer))
   05A1 21 10 00      [10]  918 	ld	hl, #16
   05A4 39            [11]  919 	add	hl, sp
   05A5 7E            [ 7]  920 	ld	a, (hl)
   05A6 23            [ 6]  921 	inc	hl
   05A7 66            [ 7]  922 	ld	h, (hl)
   05A8 6F            [ 4]  923 	ld	l, a
   05A9 E5            [11]  924 	push	hl
   05AA C5            [11]  925 	push	bc
   05AB D5            [11]  926 	push	de
   05AC 33            [ 6]  927 	inc	sp
   05AD CDr00r00      [17]  928 	call	_ch376s_disk_write
   05B0 F1            [10]  929 	pop	af
   05B1 F1            [10]  930 	pop	af
   05B2 33            [ 6]  931 	inc	sp
   05B3 CB 45         [ 8]  932 	bit	0, l
                            933 ;../generic/usbdisk.c:211: return false;
                            934 ;../generic/usbdisk.c:214: return true;
   05B5 2E 00         [ 7]  935 	ld	l, #0x00
   05B7 28 02         [12]  936 	jr	Z,00112$
   05B9                     937 00111$:
   05B9 2E 01         [ 7]  938 	ld	l, #0x01
   05BB                     939 00112$:
                            940 ;../generic/usbdisk.c:215: }
   05BB FD 21 0A 00   [14]  941 	ld	iy, #10
   05BF FD 39         [15]  942 	add	iy, sp
   05C1 FD F9         [10]  943 	ld	sp, iy
   05C3 C9            [10]  944 	ret
                            945 ;../generic/usbdisk.c:217: bool read_write_disk_sectors (bool writing,uint8_t nr_sectors,uint32_t* sector,uint8_t* sector_buffer)
                            946 ;	---------------------------------
                            947 ; Function read_write_disk_sectors
                            948 ; ---------------------------------
   05C4                     949 _read_write_disk_sectors::
   05C4 DD E5         [15]  950 	push	ix
   05C6 DD 21 00 00   [14]  951 	ld	ix,#0
   05CA DD 39         [15]  952 	add	ix,sp
                            953 ;../generic/usbdisk.c:221: if (!ch376s_disk_read (nr_sectors,(uint8_t*)sector,sector_buffer))
   05CC DD 4E 06      [19]  954 	ld	c, 6 (ix)
   05CF DD 46 07      [19]  955 	ld	b, 7 (ix)
                            956 ;../generic/usbdisk.c:219: if (!writing)
   05D2 DD CB 04 46   [20]  957 	bit	0, 4 (ix)
   05D6 20 1B         [12]  958 	jr	NZ,00106$
                            959 ;../generic/usbdisk.c:221: if (!ch376s_disk_read (nr_sectors,(uint8_t*)sector,sector_buffer))
   05D8 DD 6E 08      [19]  960 	ld	l, 8 (ix)
   05DB DD 66 09      [19]  961 	ld	h, 9 (ix)
   05DE E5            [11]  962 	push	hl
   05DF C5            [11]  963 	push	bc
   05E0 DD 7E 05      [19]  964 	ld	a, 5 (ix)
   05E3 F5            [11]  965 	push	af
   05E4 33            [ 6]  966 	inc	sp
   05E5 CDr00r00      [17]  967 	call	_ch376s_disk_read
   05E8 F1            [10]  968 	pop	af
   05E9 F1            [10]  969 	pop	af
   05EA 33            [ 6]  970 	inc	sp
   05EB CB 45         [ 8]  971 	bit	0, l
   05ED 20 1D         [12]  972 	jr	NZ,00107$
                            973 ;../generic/usbdisk.c:222: return false;
   05EF 2E 00         [ 7]  974 	ld	l, #0x00
   05F1 18 1B         [12]  975 	jr	00108$
   05F3                     976 00106$:
                            977 ;../generic/usbdisk.c:226: if (!ch376s_disk_write (nr_sectors,(uint8_t*)sector,sector_buffer))
   05F3 DD 6E 08      [19]  978 	ld	l, 8 (ix)
   05F6 DD 66 09      [19]  979 	ld	h, 9 (ix)
   05F9 E5            [11]  980 	push	hl
   05FA C5            [11]  981 	push	bc
   05FB DD 7E 05      [19]  982 	ld	a, 5 (ix)
   05FE F5            [11]  983 	push	af
   05FF 33            [ 6]  984 	inc	sp
   0600 CDr00r00      [17]  985 	call	_ch376s_disk_write
   0603 F1            [10]  986 	pop	af
   0604 F1            [10]  987 	pop	af
   0605 33            [ 6]  988 	inc	sp
   0606 CB 45         [ 8]  989 	bit	0, l
                            990 ;../generic/usbdisk.c:227: return false;
                            991 ;../generic/usbdisk.c:230: return true;
   0608 2E 00         [ 7]  992 	ld	l, #0x00
   060A 28 02         [12]  993 	jr	Z,00108$
   060C                     994 00107$:
   060C 2E 01         [ 7]  995 	ld	l, #0x01
   060E                     996 00108$:
                            997 ;../generic/usbdisk.c:231: }
   060E DD E1         [14]  998 	pop	ix
   0610 C9            [10]  999 	ret
                           1000 ;../generic/usbdisk.c:233: bool usbdisk_close_dsk_file ()
                           1001 ;	---------------------------------
                           1002 ; Function usbdisk_close_dsk_file
                           1003 ; ---------------------------------
   0611                    1004 _usbdisk_close_dsk_file::
                           1005 ;../generic/usbdisk.c:235: return ch376_close_file();
                           1006 ;../generic/usbdisk.c:236: }
   0611 C3r00r00      [10] 1007 	jp	_ch376_close_file
                           1008 	.area _CODE
                           1009 	.area _INITIALIZER
                           1010 	.area _CABS (ABS)
